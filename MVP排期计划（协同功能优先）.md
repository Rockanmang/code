# MVP排期计划（协同功能优先）

## **项目名称**：人工智能协同文献管理系统 MVP

**项目名称**：人工智能协同文献管理系统 MVP（协同功能优先）
**MVP 目标**：交付一个功能原型，展示用户认证、研究组创建/加入、公共文献上传/查看，以及共享组内核心 AI 问答功能。
**时间线**：7 天（开始：2025 年 5 月 21 日 - 结束：2025 年 5 月 26 日）

---

### MVP 范围定义（协同功能优先）

为在 7 天内完成可演示的 MVP，我们将聚焦以下核心协同功能：

- **用户系统**：账号创建与登录。
- **研究组管理**：创建研究组、加入研究组。
- **文献管理（公共库）**：向公共组库上传 PDF/Word/HTML 文件，并查看文献（具备基本显示功能的在线阅读器）。
- **AI 助手**：唤醒 AI 助手，并针对公共库中当前查看的文档提供 AI 问答功能。

**MVP 不包含的范围**（后续迭代版本实现）：

- 私人文献库 。
- 退出研究组 。
- 协作功能（批注、@提及、实时同步） 。
- AI 跨文献关联 。
- 高级在线阅读器功能（高亮、缩放、目录跳转等超出基本显示的功能） 。
- 非功能性需求（如完全并发处理、国际化、除基本日志外的详细错误跟踪） 。
- 群组管理的管理员功能 。

---

### 详细 7 天工作计划（协同功能优先）

**第 1 天：环境搭建与用户系统（认证）**

- **目标**：搭建开发环境，配置 Next.js 和 FastAPI，实现用户注册和登录接口。
- **任务**：
    - **项目初始化（前端 - Next.js）**：
        - 创建使用 App Router 的新 Next.js 项目 。
        - 安装 Shadcn/ui 和 TailwindCSS 。
        - 配置登录/注册页面的基本布局 。
    - **项目初始化（后端 - FastAPI）**：
        - 创建新的 FastAPI 项目 。
        - 设置基本项目结构（路由、模型、服务）。
        - 安装必要依赖（如用于密码哈希的 `passlib`，用于认证的 `python-jose` 或 `PyJWT`）。
        - 初始化简单数据库（如本地开发的 SQLite），并定义用户模式（手机号、哈希密码、用户名）。
    - **用户注册接口（后端）**：
        - 实现 `/auth/register` 接口 (POST) 。
        - 验证输入数据（手机号唯一性） 。
        - 哈希密码（SHA-256 或 bcrypt） 。
        - 将用户存储到数据库 。
        - 返回成功/失败消息 。
    - **用户登录接口（后端）**：
        - 实现 `/auth/login` 接口 (POST) 。
        - 验证凭证（手机号和密码）.
        - 登录成功时生成 JWT 令牌.
        - 返回 JWT 令牌或错误消息.
    - **基本前端集成**：
        - 在 Next.js 中创建登录和注册表单 。
        - 将表单连接到后端 API 接口 。
        - 实现表单的客户端验证 。
- **交付物**：
    - 初始化的 Next.js 和 FastAPI 项目。
    - 功能完善的用户注册 API 接口。
    - 功能完善的用户登录 API 接口。
    - 连接到后端的基本登录/注册 UI。
- **工具**：Next.js、FastAPI、SQLAlchemy/Pydantic、SQLite、Git。

**第 2 天：研究组管理（创建与加入）**

- **目标**：实现用户创建和加入研究组的功能。
- **任务**：
    - **数据库模式扩展（后端）**：
        - 向数据库添加 `ResearchGroup` 表（组名、机构、描述、研究领域、邀请码、唯一 ID）。
        - 在用户和研究组之间添加多对多关系以跟踪组成员。
    - **创建研究组接口（后端）**：
        - 实现 `/groups/create` 接口 (POST)，要求认证 。
        - 创建时生成唯一的 `researchGroup ID` 。
        - 存储组详情，并将创建用户关联为成员.
    - **加入研究组接口（后端）**：
        - 实现 `/groups/join` 接口 (POST)，要求认证 。
        - 接收 `researchGroup ID` 和邀请码 。
        - 验证 ID 和邀请码 。
        - 检查用户是否已为成员.
        - 若有效且未加入，则将用户添加到组中.
    - **前端组管理 UI**：
        - 修改个人资料页面，显示 “创建课题组” 和 “加入课题组” 按钮.
        - 创建用于创建和加入组的表单.
        - 成功创建后显示组名和 ID.
        - 确保主页左侧目录面板在用户加入组后添加 “公有文献库（课题组名称）”.
- **交付物**：
    - 用于创建和加入研究组的后端 API。
    - 更新后的组和成员数据库模式。
    - 反映组状态的前端 UI（创建和加入组）。
- **工具**：FastAPI、SQLAlchemy/Pydantic、Next.js。

**第 3 天：公共文献上传与存储**

- **目标**：允许研究组成员向其公共组库上传文献，包括文件存储和基本元数据提取。
- **任务**：
    - **文件上传接口（后端 - 组上下文）**：
        - 实现 `/literature/upload` 接口 (POST)，接受 `researchGroup ID` 。
        - 确保只有认证的组成员可以向其组库上传文件。
        - 使用 `python-multipart` 处理文件.
        - 配置存储（如按组 ID 组织的本地磁盘存储）。
        - 集成 `PyPDF2` 从 PDF 中提取基本文本.
        - 对于 Word/HTML，MVP 阶段先聚焦于文件存储。
    - **元数据提取与存储（后端）**：
        - 上传时从文档中提取标题、作者、摘要.
        - 在文献数据库表中存储文件路径、提取的元数据、`researchGroup ID`，以及智能标签占位符.
    - **前端上传 UI**：
        - 在 “公有文献库” 视图中添加 “上传” 按钮.
        - 实现文件选择组件。
        - 连接到后端上传接口，传递当前 `researchGroup ID`。
        - 上传成功时显示确认消息。
    - **公共文献库列表（后端）**：
        - 实现 `/literature/public/{group_id}` 接口 (GET) 以列出特定研究组的文献。
        - 从数据库检索元数据。
    - **公共文献库展示（前端）**：
        - 用户加入组后，左侧目录面板显示 “公有文献库（课题组名称）”.
        - 点击后获取并显示该组上传的文献（标题、作者）。
        - 必要时显示新文档红点（MVP 阶段手动触发）.
- **交付物**：
    - 与研究组集成的后端文件上传 API。
    - 与组 ID 关联的基本元数据提取和存储。
    - 公共库的前端上传 UI。
    - 显示组文献的公共文献库界面。
- **工具**：FastAPI、`python-multipart`、`PyPDF2`、SQLAlchemy/Pydantic、Next.js。

**第 4 天：文献查看与 AI 核心基础搭建**

- **目标**：允许用户在组上下文中通过基本在线阅读器查看上传文献，并开始搭建 RAG（检索增强生成）管道。
- **任务**：
    - **文献服务接口（后端）**：
        - 实现 `/literature/view/{literature_id}` 接口 (GET) 以提供上传文档内容（如 PDF 流）.
        - 确保访问控制：仅文献所属组的成员可查看。
    - **在线阅读器组件（前端）**：
        - 将 PDF 查看器库（如 `react-pdf` 或指向 PDF 文件的简单 iframe）集成到 Next.js 应用中.
        - 聚焦 PDF 的基本渲染。
    - **查看交互（前端）**：
        - 实现公共库中文献名称双击打开在线阅读器.
        - 确保阅读器组件接收文献 ID 以获取并显示正确文件。
    - **AI 悬浮球 UI（前端）**：
        - 在阅读器界面右下角放置悬浮球图标.
        - 点击时显示最小化可扩展对话框（如简单的 div 展开/折叠）.
    - **文本分块与嵌入（后端/脚本）**：
        - 在 FastAPI 中开发脚本或服务，在组文献 PDF 上传时处理提取的文本。
        - 将文本分块为可管理的段落。
        - 使用 OpenAI API 的 `text-embedding-3-small` 为每个块生成嵌入向量.
    - **向量数据库集成（初始）**：
        - 选择向量数据库（如 Pinecone 免费层或本地 `Faiss` ）。
        - 将文本块及其嵌入向量插入向量数据库，并关联文献 ID 和 `researchGroup ID`.
- **交付物**：
    - 带访问控制的后端文献服务接口。
    - 集成到前端的基本在线 PDF 阅读器。
    - 打开组文献进行查看的功能。
    - 占位符 AI 助手 UI。
    - 文本分块并嵌入向量数据库的后端基础设置。
- **工具**：Next.js、`react-pdf`（或类似库）、FastAPI、`openai` 库、Pinecone/Weaviate/Faiss。

**第 5 天：AI 助手集成（当前文档问答）**

- **目标**：将 AI 助手 UI 连接到 RAG 管道，为组公共库中当前查看的文档提供实时问答。
- **任务**：
    - **LangChain 搭建（后端）**：
        - 将 LangChain 集成到 FastAPI 后端.
        - 配置 LangChain 连接向量数据库.
        - 搭建基本 RAG 链，可根据查询和特定文献 ID 检索相关文档块.
    - **AI 问答接口（后端）**：
        - 在 FastAPI 中实现 `/ai/ask` 接口 (POST)，要求认证.
        - 该接口接收用户查询和当前查看文献的 ID。
        - 使用 LangChain RAG 管道：
            - 嵌入用户查询.
            - 在向量数据库中执行相似性搜索，仅从指定文献中检索相关块.
            - 通过 OpenAI API 将块和查询传递给大语言模型（LLM）生成回答.
            - 基于检索到的块识别并在回答中包含引用来源.
    - **前端 AI 对话界面**：
        - 增强 AI 助手 UI（可扩展对话框）.
        - 添加用户问题输入框.
        - 显示预设问题（如 “总结核心论点”）.
        - 显示 AI 回答.
        - 将前端输入连接到 `/ai/ask` 后端接口，传递打开文献的 ID。
    - **基础多轮对话**：
        - 实现基础上下文传递以支持多轮对话（如通过向 LLM 发送消息数组中的历史对话），聚焦单文档内的上下文维护.
- **交付物**：
    - 功能完善的组文献 AI 问答接口。
    - 前端交互式 AI 助手界面。
    - 能够回答当前查看文献问题并附带引用来源的 AI 功能。
    - 基础多轮对话支持。
- **工具**：Next.js、FastAPI、LangChain、OpenAI API。

**第 6 天：功能优化、测试与错误处理（群组聚焦）**

- **目标**：优化现有功能，执行基本测试，实现关键错误处理，重点关注群组相关流程。
- **任务**：
    - **前端 UI/UX 优化**：
        - 使用 Shadcn/ui 和 TailwindCSS 审查并改进登录、注册、组创建/加入表单、公共文献列表和阅读器页面的外观和体验.
        - 确保桌面端响应式设计.
    - **错误处理（前端与后端 - 群组上下文）**：
        - 为所有 API 调用实现健壮的错误处理，尤其是组创建/加入场景（如无效邀请码、已加入组）.
        - 显示用户友好的错误消息.
        - 向后端添加基本日志记录。
    - **单元与集成测试（基础）**：
        - 为关键后端服务编写基础单元测试（如用户认证、组创建/加入、文献上传解析）.
        - 对关键协同用户流程执行手动集成测试：
            - 用户 A 注册→创建组 A.
            - 用户 B 注册→使用 ID/邀请码加入组 A.
            - 用户 A 向组 A 公共库上传文档.
            - 用户 B 查看组 A 公共库中的文档.
            - 用户 B 针对该文档提问 AI.
    - **代码审查与文档**：
        - 进行内部代码审查.
        - 为代码复杂部分添加注释.
        - 更新前端和后端的 README 文件.
- **交付物**：
    - 核心 MVP 功能（尤其是群组相关）的优化 UI/UX。
    - 系统级基本错误处理，重点覆盖群组流程。
    - 聚焦协同功能的初始单元/集成测试集。
    - 代码整洁且带注释的代码库。
- **工具**：`pytest`（后端单元测试）、手动测试.

**第 7 天：MVP 演示与部署准备（协同 MVP）**

- **目标**：为 MVP 演示做准备，搭建基本部署环境以展示可运行的协同原型。
- **任务**：
    - **最终测试与漏洞修复**：
        - 对协同 MVP 功能执行最终端到端测试.
        - 修复发现的关键漏洞.
    - **演示脚本/流程设计**：
        - 准备聚焦群组协同的简短演示脚本，展示 MVP 功能：
            - 演示用户 A 创建组.
            - 演示用户 B 加入该组.
            - 演示用户 A（或 B）向公共库上传文档.
            - 演示用户 A 和 B 均可从同一公共库查看该文档.
            - 演示对共享文档的 AI 问答.
            - 突出群组管理和共享文献访问的用户旅程.
    - **部署（本地/基础云部署）**：
        - 使用 Docker Compose 实现一致的本地开发环境.
        - 为快速部署 MVP，将前端部署到 Vercel，后端部署到 Render（若可行），优先实现可访问性而非高扩展性生产部署.
    - **反馈收集计划**：
        - 制定收集 MVP 反馈的方案，为后续迭代提供依据.
- **交付物**：
    - 完整演示群组创建、加入、共享文献上传/查看及 AI 问答功能的 MVP。
    - 准备好的协同 MVP 演示。
    - 部署到公共 URL 的 MVP（若当天可行）。
    - MVP 后反馈收集计划。
- **工具**：Docker Compose、Vercel、Render（或类似免费层托管服务）.

---

### 应急计划与风险管理（协同 MVP）

- **群组管理复杂度**：若第 2 天群组权限和成员列表管理过于复杂，MVP 阶段简化为仅创建和加入，所有成员平等访问，管理员角色后续添加.
- **跨文档 AI 功能**：尽管 MVP 不包含 AI 跨文献关联，确保向量数据库结构支持按 `researchGroup ID` 标记文献，为未来扩展预留空间.
- **实时 UI 更新**：MVP 阶段新文档或群组变更可能需要手动刷新，实时更新（如公共库使用 WebSocket）可延后实现.
- **多用户测试**：确保使用多个用户账号进行充分手动测试，验证共享库功能.
- **技术债**：确认快速开发将产生技术债，记录为优先速度而非长期可维护性的 MVP 功能决策.